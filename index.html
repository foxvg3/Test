<!DOCTYPE html>
<html lang="ru" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="google" content="notranslate">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Survivor.io Full Code</title>
    <style>
        body { 
            margin: 0; 
            background: #020202; 
            overflow: hidden; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            touch-action: none; 
            color: white; 
            user-select: none; 
        }
        canvas { 
            display: block; 
            position: absolute; 
            inset: 0; 
            z-index: 1; 
        }
        #ui { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            padding: 20px; 
            box-sizing: border-box; 
            z-index: 10; 
            pointer-events: none; 
        }
        #exp-bar { 
            width: 100%; 
            height: 10px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 5px; 
            overflow: hidden; 
            margin-bottom: 10px; 
            border: 1px solid rgba(255,255,255,0.2);
        }
        #exp-fill { 
            width: 0%; 
            height: 100%; 
            background: #00d4ff; 
            box-shadow: 0 0 15px #00d4ff; 
            transition: width 0.3s ease;
        }
        #hp-bar { 
            width: 160px; 
            height: 16px; 
            background: #333; 
            border-radius: 8px; 
            border: 2px solid #000; 
            overflow: hidden; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        #hp-fill { 
            width: 100%; 
            height: 100%; 
            background: linear-gradient(90deg, #ff4d4d, #ff0000); 
        }
        .stats {
            margin-top: 12px;
            display: flex;
            gap: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,1);
        }
        .overlay { 
            position: fixed; 
            inset: 0; 
            background: radial-gradient(circle, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.95) 100%); 
            z-index: 100; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .modal { 
            background: #111; 
            padding: 40px; 
            border-radius: 30px; 
            border: 2px solid #00d4ff; 
            text-align: center; 
            width: 85%; 
            max-width: 320px; 
            box-shadow: 0 0 50px rgba(0,212,255,0.3);
        }
        .btn { 
            background: linear-gradient(180deg, #00d4ff 0%, #008fb3 100%); 
            color: #000; 
            padding: 16px 40px; 
            border-radius: 15px; 
            cursor: pointer; 
            font-weight: 900; 
            margin-top: 25px; 
            display: inline-block; 
            pointer-events: all; 
            text-transform: uppercase;
            box-shadow: 0 5px 15px rgba(0,212,255,0.4);
        }
        #joystick-container { 
            position: absolute; 
            bottom: 70px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 130px; 
            height: 130px; 
            z-index: 50; 
        }
        #joystick-base { 
            width: 100%; 
            height: 100%; 
            background: rgba(255,255,255,0.03); 
            border-radius: 50%; 
            border: 2px solid rgba(255,255,255,0.1); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        #joystick-stick { 
            width: 55px; 
            height: 55px; 
            background: #00d4ff; 
            border-radius: 50%; 
            opacity: 0.5; 
            box-shadow: 0 0 20px #00d4ff;
        }
        #adm-btn { 
            position: fixed; 
            top: 70px; 
            right: 20px; 
            background: rgba(0,212,255,0.1); 
            padding: 10px 15px; 
            border-radius: 10px; 
            z-index: 60; 
            cursor: pointer; 
            pointer-events: all; 
            border: 1px solid #00d4ff;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div id="ui" style="display:none">
    <div id="exp-bar"><div id="exp-fill"></div></div>
    <div id="hp-bar"><div id="hp-fill"></div></div>
    <div class="stats">
        <span style="color:#ffd700">GOLD: <span id="g-ui">0</span></span>
        <span style="color:#00d4ff">LVL: <span id="l-ui">1</span></span>
    </div>
</div>

<div id="adm-btn" onclick="addCheat()">+10000 GOLD</div>

<div id="start-screen" class="overlay">
    <div class="modal">
        <h1 style="color:#00d4ff; margin:0 0 10px 0; font-size:32px;">SURVIVOR</h1>
        <p style="color:#666; margin-bottom:20px;">Версия 5.0 Stable</p>
        <div class="btn" onclick="startGame()">ИГРАТЬ</div>
    </div>
</div>

<canvas id="game"></canvas>

<div id="joystick-container">
    <div id="joystick-base">
        <div id="joystick-stick"></div>
    </div>
</div>

<script>
/** --- ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ --- **/
let gameActive = false;
let player = {
    x: 0,
    y: 0,
    hp: 250,
    maxHp: 250,
    speed: 4.2,
    gold: 0,
    exp: 0,
    nextExp: 100,
    lvl: 1,
    dmg: 60
};

let enemies = [];
let bullets = [];
let crystals = [];
let joy = { active: false, dx: 0, dy: 0 };
let lastTime = 0;
let spawnTimer = 0;
let shootTimer = 0;

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

/** --- ПОДГОТОВКА ФОНА --- **/
const tSize = 120;
const tile = document.createElement('canvas');
const tCtx = tile.getContext('2d');
tile.width = tSize;
tile.height = tSize;

function drawTile() {
    tCtx.fillStyle = '#161b16';
    tCtx.fillRect(0, 0, tSize, tSize);
    tCtx.strokeStyle = 'rgba(0,0,0,0.2)';
    tCtx.lineWidth = 2;
    tCtx.strokeRect(0, 0, tSize, tSize);
    
    // Текстура травы
    for(let i=0; i<4; i++) {
        tCtx.fillStyle = 'rgba(255,255,255,0.02)';
        tCtx.fillRect(Math.random()*tSize, Math.random()*tSize, 3, 3);
    }
}
drawTile();

/** --- СИСТЕМНЫЕ ФУНКЦИИ --- **/
function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('ui').style.display = 'block';
    resize();
    gameActive = true;
    lastTime = performance.now();
    requestAnimationFrame(loop);
}

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);

function addCheat() {
    player.gold += 10000;
    player.exp += 200;
    updateUI();
}

function updateUI() {
    document.getElementById('g-ui').innerText = player.gold;
    document.getElementById('l-ui').innerText = player.lvl;
    document.getElementById('hp-fill').style.width = (player.hp / player.maxHp * 100) + '%';
    document.getElementById('exp-fill').style.width = (player.exp / player.nextExp * 100) + '%';

    if (player.exp >= player.nextExp) {
        player.lvl++;
        player.exp = 0;
        player.nextExp = Math.floor(player.nextExp * 1.6);
        player.maxHp += 50;
        player.hp = player.maxHp;
        player.dmg += 20;
        player.speed += 0.1;
    }
}

/** --- УПРАВЛЕНИЕ --- **/
function handleInput(e) {
    if (!gameActive) return;
    const touch = e.touches[0];
    const rect = document.getElementById('joystick-base').getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    const diffX = touch.clientX - centerX;
    const diffY = touch.clientY - centerY;
    const distance = Math.sqrt(diffX * diffX + diffY * diffY);
    const maxRadius = rect.width / 2;
    const angle = Math.atan2(diffY, diffX);
    
    joy.active = true;
    const moveDist = Math.min(distance, maxRadius);
    joy.dx = Math.cos(angle) * (moveDist / maxRadius);
    joy.dy = Math.sin(angle) * (moveDist / maxRadius);
    
    document.getElementById('joystick-stick').style.transform = 
        `translate(${Math.cos(angle) * moveDist}px, ${Math.sin(angle) * moveDist}px)`;
}

document.addEventListener('touchstart', (e) => {
    if (e.target.closest('#joystick-container')) handleInput(e);
});

document.addEventListener('touchmove', (e) => {
    if (joy.active) {
        e.preventDefault();
        handleInput(e);
    }
}, { passive: false });

document.addEventListener('touchend', () => {
    joy.active = false;
    joy.dx = 0;
    joy.dy = 0;
    document.getElementById('joystick-stick').style.transform = 'translate(0,0)';
});

/** --- ИГРОВОЙ ЦИКЛ --- **/
function loop(now) {
    if (!gameActive) return;
    const deltaTime = now - lastTime;
    lastTime = now;

    // Движение игрока
    if (joy.active) {
        player.x += joy.dx * player.speed;
        player.y += joy.dy * player.speed;
    }

    // Авто-стрельба по таймеру
    shootTimer += deltaTime;
    if (shootTimer > 750) {
        shootAtNearest();
        shootTimer = 0;
    }

    // Спавн врагов
    spawnTimer += deltaTime;
    if (spawnTimer > 1100 && enemies.length < 45) {
        spawnEnemy();
        spawnTimer = 0;
    }

    updateObjects();
    render();
    requestAnimationFrame(loop);
}

function spawnEnemy() {
    const angle = Math.random() * Math.PI * 2;
    const distance = 700;
    enemies.push({
        x: player.x + Math.cos(angle) * distance,
        y: player.y + Math.sin(angle) * distance,
        hp: 100 + (player.lvl * 15),
        speed: 1.8 + (player.lvl * 0.05)
    });
}

function shootAtNearest() {
    if (enemies.length === 0) return;
    
    let target = null;
    let minD = Infinity;
    
    enemies.forEach(e => {
        const d = Math.sqrt((e.x - player.x)**2 + (e.y - player.y)**2);
        if (d < minD) {
            minD = d;
            target = e;
        }
    });

    if (target && minD < 600) {
        const angle = Math.atan2(target.y - player.y, target.x - player.x);
        bullets.push({
            x: player.x,
            y: player.y,
            vx: Math.cos(angle) * 14,
            vy: Math.sin(angle) * 14
        });
    }
}

function updateObjects() {
    // Пули
    for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        b.x += b.vx;
        b.y += b.vy;
        
        if (Math.abs(b.x - player.x) > 1000 || Math.abs(b.y - player.y) > 1000) {
            bullets.splice(i, 1);
        }
    }

    // Кристаллы
    for (let i = crystals.length - 1; i >= 0; i--) {
        const c = crystals[i];
        const d = Math.sqrt((c.x - player.x)**2 + (c.y - player.y)**2);
        if (d < 60) {
            player.exp += 35;
            crystals.splice(i, 1);
            updateUI();
        }
    }

    // Враги
    for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        
        e.x += (dx / dist) * e.speed;
        e.y += (dy / dist) * e.speed;

        // Попадание пули
        for (let j = bullets.length - 1; j >= 0; j--) {
            const b = bullets[j];
            const hitDist = Math.sqrt((b.x - e.x)**2 + (b.y - e.y)**2);
            if (hitDist < 30) {
                e.hp -= player.dmg;
                bullets.splice(j, 1);
            }
        }

        if (e.hp <= 0) {
            player.gold += 15;
            crystals.push({ x: e.x, y: e.y });
            enemies.splice(i, 1);
            updateUI();
            continue;
        }

        if (dist < 30) {
            player.hp -= 0.5;
            updateUI();
        }

        if (dist > 1300) enemies.splice(i, 1);
    }

    if (player.hp <= 0) {
        alert("ИГРА ОКОНЧЕНА! ВАШ УРОВЕНЬ: " + player.lvl);
        location.reload();
    }
}

function render() {
    const screenCX = canvas.width / 2;
    const screenCY = canvas.height / 2;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Отрисовка плиток фона
    const offsetX = -player.x % tSize - tSize;
    const offsetY = -player.y % tSize - tSize;
    
    for (let x = offsetX; x < canvas.width + tSize; x += tSize) {
        for (let y = offsetY; y < canvas.height + tSize; y += tSize) {
            ctx.drawImage(tile, x, y);
        }
    }

    // Кристаллы
    ctx.fillStyle = '#00ffcc';
    crystals.forEach(c => {
        ctx.beginPath();
        ctx.arc(c.x - player.x + screenCX, c.y - player.y + screenCY, 6, 0, Math.PI * 2);
        ctx.fill();
    });

    // Пули
    ctx.fillStyle = '#ffff00';
    bullets.forEach(b => {
        ctx.fillRect(b.x - player.x + screenCX - 5, b.y - player.y + screenCY - 5, 10, 10);
    });

    // Враги
    ctx.fillStyle = '#ff4d4d';
    enemies.forEach(e => {
        ctx.beginPath();
        ctx.arc(e.x - player.x + screenCX, e.y - player.y + screenCY, 20, 0, Math.PI * 2);
        ctx.fill();
        
        // Полоска здоровья врага
        ctx.fillStyle = '#000';
        ctx.fillRect(e.x - player.x + screenCX - 15, e.y - player.y + screenCY - 30, 30, 4);
    });

    // Игрок
    ctx.fillStyle = '#00d4ff';
    ctx.shadowBlur = 20;
    ctx.shadowColor = '#00d4ff';
    ctx.fillRect(screenCX - 15, screenCY - 15, 30, 30);
    ctx.shadowBlur = 0;
}
</script>
</body>
  </html>
