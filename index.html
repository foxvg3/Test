<!DOCTYPE html>
<html lang="ru" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="google" content="notranslate">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Survivor.io Mega Build</title>
    <style>
        body { 
            margin: 0; 
            background: #020202; 
            overflow: hidden; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            touch-action: none; 
            color: white; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
        }
        canvas { 
            display: block; 
            position: absolute; 
            inset: 0; 
            z-index: 1; 
        }
        #ui-layer { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 10; 
            pointer-events: none; 
        }
        .hud-container {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #exp-container {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        #exp-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #005f7a);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
            transition: width 0.3s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }
        #hp-container {
            width: 180px;
            height: 20px;
            background: #1a1a1a;
            border: 2px solid #000;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        #hp-bar {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #ff4d4d 0%, #b30000 100%);
            transition: width 0.2s ease;
        }
        #hp-text {
            position: absolute;
            width: 100%;
            text-align: center;
            font-size: 12px;
            font-weight: 900;
            line-height: 20px;
            color: white;
            text-shadow: 1px 1px 2px black;
        }
        .stats-row {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        .stat-item { display: flex; align-items: center; gap: 5px; }
        .gold-icon { color: #ffd700; }
        .lvl-icon { color: #00d4ff; }
        .timer-icon { color: #ffffff; font-family: monospace; }

        #joystick-wrapper {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            z-index: 100;
            pointer-events: all;
        }
        #joystick-base {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 70%);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px);
        }
        #joystick-stick {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #00d4ff 0%, #008fb3 100%);
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.4);
            transition: transform 0.05s linear;
        }

        #screen-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .menu-card {
            background: #111;
            padding: 40px;
            border-radius: 30px;
            border: 2px solid #00d4ff;
            text-align: center;
            box-shadow: 0 0 100px rgba(0, 212, 255, 0.2);
            max-width: 320px;
            width: 90%;
        }
        .game-title {
            font-size: 36px;
            margin: 0 0 10px 0;
            background: linear-gradient(to bottom, #fff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
            letter-spacing: -1px;
        }
        .play-btn {
            background: #00d4ff;
            color: #000;
            padding: 18px 45px;
            border-radius: 15px;
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
            margin-top: 30px;
            display: inline-block;
            pointer-events: all;
            box-shadow: 0 10px 20px rgba(0, 212, 255, 0.3);
            transition: transform 0.1s;
        }
        .play-btn:active { transform: scale(0.95); }

        #admin-panel {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 500;
            pointer-events: all;
        }
        .admin-btn {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid #00d4ff;
            color: #00d4ff;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="ui-layer" style="display:none">
    <div class="hud-container">
        <div id="exp-container"><div id="exp-bar"></div></div>
        <div id="hp-container">
            <div id="hp-bar"></div>
            <div id="hp-text">100 / 100</div>
        </div>
        <div class="stats-row">
            <div class="stat-item"><span class="gold-icon">üí∞</span> <span id="gold-val">0</span></div>
            <div class="stat-item"><span class="lvl-icon">‚≠ê</span> <span id="lvl-val">1</span></div>
            <div class="stat-item"><span class="timer-icon" id="timer-val">00:00</span></div>
        </div>
    </div>
</div>

<div id="admin-panel">
    <button class="admin-btn" onclick="game.addGold(5000)">+5000 GOLD</button>
</div>

<div id="screen-overlay">
    <div class="menu-card">
        <h1 class="game-title">SURVIVOR.IO</h1>
        <p style="color: #555; font-size: 14px;">ULTIMATE MOBILE EDITION</p>
        <div class="play-btn" onclick="game.start()">–ò–ì–†–ê–¢–¨</div>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<div id="joystick-wrapper">
    <div id="joystick-base"><div id="joystick-stick"></div></div>
</div>

<script>
"use strict";

const game = {
    active: false,
    width: 0,
    height: 0,
    startTime: 0,
    elapsed: 0,
    
    player: {
        x: 0, y: 0,
        hp: 300, maxHp: 300,
        speed: 4.5,
        gold: 0,
        exp: 0, nextExp: 100, lvl: 1,
        size: 32,
        dmg: 55,
        pickRadius: 100
    },

    input: {
        joyActive: false,
        dx: 0, dy: 0,
        angle: 0
    },

    entities: {
        enemies: [],
        bullets: [],
        items: [],
        particles: []
    },

    timers: {
        spawn: 0,
        shoot: 0,
        lastFrame: 0
    },

    canvas: document.getElementById('gameCanvas'),
    ctx: null,
    
    // –ü–ª–∏—Ç–∫–∞ –ø–æ–ª–∞ (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
    bgTile: null,

    init() {
        this.ctx = this.canvas.getContext('2d', { alpha: false });
        this.resize();
        this.createBgTile();
        window.addEventListener('resize', () => this.resize());
        this.setupControls();
    },

    resize() {
        this.width = window.innerWidth;
        this.height = window.innerHeight;
        this.canvas.width = this.width;
        this.canvas.height = this.height;
    },

    createBgTile() {
        const size = 128;
        const t = document.createElement('canvas');
        t.width = size; t.height = size;
        const tc = t.getContext('2d');
        tc.fillStyle = '#111811';
        tc.fillRect(0, 0, size, size);
        tc.strokeStyle = '#0d120d';
        tc.lineWidth = 2;
        tc.strokeRect(0, 0, size, size);
        // –î–µ—Ç–∞–ª–∏
        tc.fillStyle = 'rgba(255,255,255,0.02)';
        for(let i=0; i<5; i++) tc.fillRect(Math.random()*size, Math.random()*size, 2, 2);
        this.bgTile = t;
    },

    start() {
        document.getElementById('screen-overlay').style.display = 'none';
        document.getElementById('ui-layer').style.display = 'block';
        this.active = true;
        this.startTime = performance.now();
        this.timers.lastFrame = performance.now();
        this.updateUI();
        requestAnimationFrame((t) => this.loop(t));
    },

    addGold(v) {
        this.player.gold += v;
        this.updateUI();
    },

    updateUI() {
        document.getElementById('gold-val').innerText = Math.floor(this.player.gold);
        document.getElementById('lvl-val').innerText = this.player.lvl;
        document.getElementById('hp-bar').style.width = (this.player.hp / this.player.maxHp * 100) + '%';
        document.getElementById('hp-text').innerText = `${Math.ceil(this.player.hp)} / ${this.player.maxHp}`;
        document.getElementById('exp-bar').style.width = (this.player.exp / this.player.nextExp * 100) + '%';
    },

    setupControls() {
        const wrap = document.getElementById('joystick-wrapper');
        const stick = document.getElementById('joystick-stick');
        const base = document.getElementById('joystick-base');

        const handle = (e) => {
            if(!this.active) return;
            const touch = e.touches[0];
            const rect = base.getBoundingClientRect();
            const cx = rect.left + rect.width/2;
            const cy = rect.top + rect.height/2;
            const dx = touch.clientX - cx;
            const dy = touch.clientY - cy;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const max = rect.width/2;
            const angle = Math.atan2(dy, dx);
            
            this.input.joyActive = true;
            const clampedDist = Math.min(dist, max);
            this.input.dx = Math.cos(angle) * (clampedDist / max);
            this.input.dy = Math.sin(angle) * (clampedDist / max);
            this.input.angle = angle;

            stick.style.transform = `translate(${Math.cos(angle)*clampedDist}px, ${Math.sin(angle)*clampedDist}px)`;
        };

        wrap.addEventListener('touchstart', (e) => handle(e));
        wrap.addEventListener('touchmove', (e) => {
            e.preventDefault();
            handle(e);
        }, { passive: false });
        
        const reset = () => {
            this.input.joyActive = false;
            this.input.dx = 0; this.input.dy = 0;
            stick.style.transform = `translate(0,0)`;
        };
        
        wrap.addEventListener('touchend', reset);
        wrap.addEventListener('touchcancel', reset);
    },loop(now) {
        if (!this.active) return;
        const dt = now - this.timers.lastFrame;
        this.timers.lastFrame = now;
        this.elapsed = now - this.startTime;

        this.update(dt);
        this.render();

        requestAnimationFrame((t) => this.loop(t));
    },

    update(dt) {
        // 1. –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        if (this.input.joyActive) {
            this.player.x += this.input.dx * this.player.speed;
            this.player.y += this.input.dy * this.player.speed;
        }

        // 2. –¢–∞–π–º–µ—Ä –∏ UI –≤—Ä–µ–º–µ–Ω–∏
        const sec = Math.floor(this.elapsed / 1000);
        const m = Math.floor(sec / 60).toString().padStart(2, '0');
        const s = (sec % 60).toString().padStart(2, '0');
        document.getElementById('timer-val').innerText = `${m}:${s}`;

        // 3. –ê–≤—Ç–æ-—Å—Ç—Ä–µ–ª—å–±–∞
        this.timers.shoot += dt;
        if (this.timers.shoot > 650) {
            this.logicShoot();
            this.timers.shoot = 0;
        }

        // 4. –°–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤ (—É—Å–ª–æ–∂–Ω–µ–Ω–∏–µ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º)
        this.timers.spawn += dt;
        const spawnRate = Math.max(400, 1200 - (this.player.lvl * 50));
        if (this.timers.spawn > spawnRate && this.entities.enemies.length < 60) {
            this.logicSpawnEnemy();
            this.timers.spawn = 0;
        }

        // 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π
        this.updateBullets();
        this.updateEnemies();
        this.updateItems();
        this.updateParticles(dt);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
        if (this.player.exp >= this.player.nextExp) {
            this.levelUp();
        }
    },

    logicShoot() {
        if (this.entities.enemies.length === 0) return;
        let target = null;
        let minDist = 700;
        
        for (let e of this.entities.enemies) {
            const d = Math.hypot(e.x - this.player.x, e.y - this.player.y);
            if (d < minDist) {
                minDist = d;
                target = e;
            }
        }

        if (target) {
            const angle = Math.atan2(target.y - this.player.y, target.x - this.player.x);
            this.entities.bullets.push({
                x: this.player.x,
                y: this.player.y,
                vx: Math.cos(angle) * 15,
                vy: Math.sin(angle) * 15,
                dmg: this.player.dmg
            });
        }
    },

    logicSpawnEnemy() {
        const angle = Math.random() * Math.PI * 2;
        const dist = Math.max(this.width, this.height) / 1.5 + 100;
        const type = Math.random() > 0.9 ? 'elite' : 'normal';
        
        this.entities.enemies.push({
            x: this.player.x + Math.cos(angle) * dist,
            y: this.player.y + Math.sin(angle) * dist,
            hp: (type === 'elite' ? 500 : 100) + (this.player.lvl * 20),
            maxHp: (type === 'elite' ? 500 : 100) + (this.player.lvl * 20),
            speed: type === 'elite' ? 2.2 : 2.5,
            size: type === 'elite' ? 25 : 18,
            color: type === 'elite' ? '#ff9900' : '#ff4d4d'
        });
    },

    updateBullets() {
        for (let i = this.entities.bullets.length - 1; i >= 0; i--) {
            const b = this.entities.bullets[i];
            b.x += b.vx;
            b.y += b.vy;
            if (Math.hypot(b.x - this.player.x, b.y - this.player.y) > 1200) {
                this.entities.bullets.splice(i, 1);
            }
        }
    },

    updateEnemies() {
        for (let i = this.entities.enemies.length - 1; i >= 0; i--) {
            const e = this.entities.enemies[i];
            const dx = this.player.x - e.x;
            const dy = this.player.y - e.y;
            const dist = Math.hypot(dx, dy);

            e.x += (dx / dist) * e.speed;
            e.y += (dy / dist) * e.speed;

            // –ö–æ–ª–ª–∏–∑–∏—è —Å –ø—É–ª—è–º–∏
            for (let j = this.entities.bullets.length - 1; j >= 0; j--) {
                const b = this.entities.bullets[j];
                if (Math.hypot(b.x - e.x, b.y - e.y) < e.size + 10) {
                    e.hp -= b.dmg;
                    this.createHitParticle(e.x, e.y);
                    this.entities.bullets.splice(j, 1);
                }
            }

            // –ö–æ–ª–ª–∏–∑–∏—è —Å –∏–≥—Ä–æ–∫–æ–º
            if (dist < 35) {
                this.player.hp -= 0.6;
                this.updateUI();
                if (this.player.hp <= 0) this.gameOver();
            }

            if (e.hp <= 0) {
                this.player.gold += 10;
                this.entities.items.push({ x: e.x, y: e.y, type: 'exp' });
                this.entities.enemies.splice(i, 1);
                this.updateUI();
            }
        }
    },

    updateItems() {
        for (let i = this.entities.items.length - 1; i >= 0; i--) {
            const item = this.entities.items[i];
            const d = Math.hypot(item.x - this.player.x, item.y - this.player.y);
            
            if (d < this.player.pickRadius) {
                const dx = this.player.x - item.x;
                const dy = this.player.y - item.y;
                item.x += (dx / d) * 10;
                item.y += (dy / d) * 10;
            }

            if (d < 20) {
                this.player.exp += 40;
                this.entities.items.splice(i, 1);
                this.updateUI();
            }
        }
    },

    updateParticles(dt) {
        for (let i = this.entities.particles.length - 1; i >= 0; i--) {
            const p = this.entities.particles[i];
            p.life -= dt;
            p.x += p.vx;
            p.y += p.vy;
            if (p.life <= 0) this.entities.particles.splice(i, 1);
        }
    },

    createHitParticle(x, y) {
        for(let i=0; i<3; i++) {
            this.entities.particles.push({
                x, y,
                vx: (Math.random()-0.5)*5,
                vy: (Math.random()-0.5)*5,
                life: 300,
                color: '#fff'
            });
        }
    },

    levelUp() {
        this.player.lvl++;
        this.player.exp = 0;
        this.player.nextExp = Math.floor(this.player.nextExp * 1.5);
        this.player.maxHp += 50;
        this.player.hp = this.player.maxHp;
        this.player.dmg += 15;
        this.player.pickRadius += 5;
        this.updateUI();
    },

    render() {
        const cx = this.width / 2;
        const cy = this.height / 2;
        
        this.ctx.save();
        
        // 1. –§–æ–Ω (–ü–ª–∏—Ç–∫–∞)
        const offX = -this.player.x % 128;
        const offY = -this.player.y % 128;
        for (let x = offX - 128; x < this.width + 128; x += 128) {
            for (let y = offY - 128; y < this.height + 128; y += 128) {
                this.ctx.drawImage(this.bgTile, x, y);
            }
        }

        // 2. –ö—Ä–∏—Å—Ç–∞–ª–ª—ã –æ–ø—ã—Ç–∞
        this.ctx.fillStyle = '#00ffcc';
        for (let item of this.entities.items) {
            this.ctx.beginPath();
            this.ctx.arc(item.x - this.player.x + cx, item.y - this.player.y + cy, 5, 0, Math.PI*2);
            this.ctx.fill();
        }

        // 3. –ü—É–ª–∏
        this.ctx.fillStyle = '#ffff00';
        for (let b of this.entities.bullets) {
            this.ctx.fillRect(b.x - this.player.x + cx - 4, b.y - this.player.y + cy - 4, 8, 8);
        }

        // 4. –ß–∞—Å—Ç–∏—Ü—ã
        for (let p of this.entities.particles) {
            this.ctx.globalAlpha = p.life / 300;
            this.ctx.fillStyle = p.color;
            this.ctx.fillRect(p.x - this.player.x + cx, p.y - this.player.y + cy, 3, 3);
        }
        this.ctx.globalAlpha = 1.0;

        // 5. –í—Ä–∞–≥–∏
        for (let e of this.entities.enemies) {
            const screenX = e.x - this.player.x + cx;
            const screenY = e.y - this.player.y + cy;
            
            this.ctx.fillStyle = e.color;
            this.ctx.beginPath();
            this.ctx.arc(screenX, screenY, e.size, 0, Math.PI*2);
            this.ctx.fill();
            
            // HP –≤—Ä–∞–≥–∞
            this.ctx.fillStyle = 'rgba(0,0,0,0.5)';
            this.ctx.fillRect(screenX - 15, screenY - e.size - 10, 30, 4);
            this.ctx.fillStyle = '#ff0000';
            this.ctx.fillRect(screenX - 15, screenY - e.size - 10, (e.hp / e.maxHp) * 30, 4);
        }

        // 6. –ò–≥—Ä–æ–∫
        this.ctx.fillStyle = '#00d4ff';
        this.ctx.shadowBlur = 20;
        this.ctx.shadowColor = '#00d4ff';
        this.ctx.fillRect(cx - 16, cy - 16, 32, 32);
        this.ctx.shadowBlur = 0;

        this.ctx.restore();
    },

    gameOver() {
        this.active = false;
        alert(`–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê\n–í–∞—à —É—Ä–æ–≤–µ–Ω—å: ${this.player.lvl}\n–ó–æ–ª–æ—Ç–æ: ${Math.floor(this.player.gold)}`);
        location.reload();
    }
};

game.init();
</script>
</body>
</html>
