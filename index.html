<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MEGA SURVIVOR 2026</title>
    
    <style>
/* === // --- ACCOUNT SYSTEM ---
const account = {
    current: null,
    login() {
        const nick = document.getElementById('auth-nick').value.trim() || "Player";
        const saved = localStorage.getItem('mega_save_' + nick);
        this.current = saved ? JSON.parse(saved) : { nick, gold: 0, lvl: 1, bestTime: 0 };
        this.save();
        ui.showTab('lobby');
        this.updateUI();
    },
    save() {
        if (!this.current) return;
        localStorage.setItem('mega_save_' + this.current.nick, JSON.stringify(this.current));
    },
    updateUI() {
        document.getElementById('user-info').innerText = `–ò–ì–†–û–ö: ${this.current.nick}`;
        document.getElementById('user-gold').innerText = `üí∞ ${this.current.gold}`;
    }
};

// --- AUDIO ENGINE (No 404s) ---
const audio = {
    ctx: null,
    enabled: localStorage.getItem('mega_audio_on') !== 'false',
    init() {
        if (this.ctx) return;
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
    },
    toggle() {
        this.enabled = !this.enabled;
        localStorage.setItem('mega_audio_on', this.enabled);
        this.updateBtn();
        if (this.enabled && this.ctx?.state === 'suspended') this.ctx.resume();
    },
    updateBtn() {
        const btn = document.getElementById('btn-audio');
        if (btn) btn.innerText = this.enabled ? "SOUND: ON" : "SOUND: OFF";
    },
    play(freq, type, duration, vol) {
        if (!this.enabled || !this.ctx) return;
        const osc = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(10, this.ctx.currentTime + duration);
        g.gain.setValueAtTime(vol, this.ctx.currentTime);
        g.gain.linearRampToValueAtTime(0, this.ctx.currentTime + duration);
        osc.connect(g); g.connect(this.ctx.destination);
        osc.start(); osc.stop(this.ctx.currentTime + duration);
    },
    shoot() { this.play(800, 'triangle', 0.1, 0.05); },
    boom() { this.play(100, 'sawtooth', 0.3, 0.1); },
    lvl() { this.play(440, 'sine', 0.5, 0.1); }
};
audio.updateBtn(); === */
    </style>
</head>
<body>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MEGA SURVIVOR 2026</title>
    <style>
        :root {
            --primary: #00d4ff; --red: #ff0055; --gold: #ffcc00;
            --bg: #050805; --panel-bg: rgba(0, 20, 0, 0.9);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; }
        canvas { display: block; width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; }
        .ui-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; z-index: 10; background: rgba(0,0,0,0.5); }
        .hidden { display: none !important; }
        .panel { background: var(--panel-bg); padding: 30px; border: 2px solid var(--primary); border-radius: 15px; text-align: center; width: 90%; max-width: 400px; box-shadow: 0 0 20px var(--primary); }
        .btn { display: block; width: 100%; padding: 15px; margin: 10px 0; background: var(--primary); color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-sec { background: transparent; color: var(--primary); border: 1px solid var(--primary); }
        #hud { position: absolute; top: 0; left: 0; width: 100%; padding: 15px; pointer-events: none; z-index: 5; }
        .bar-container { width: 100%; height: 10px; background: rgba(255,255,255,0.1); margin-bottom: 5px; border-radius: 5px; }
        .bar-fill { height: 100%; width: 100%; transition: width 0.2s; border-radius: 5px; }
        .hp-bar .bar-fill { background: var(--red); }
        .exp-bar .bar-fill { background: var(--primary); }
        .stats-top { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 5px; text-shadow: 1px 1px 2px #000; }
        #joy-base { position: absolute; bottom: 40px; left: 40px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); z-index: 5; }
        #joy-stick { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: var(--primary); border-radius: 50%; opacity: 0.8; }
        input { width: 100%; padding: 12px; background: #000; border: 1px solid var(--primary); color: #fff; text-align: center; margin-bottom: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="hud" class="hidden">
        <div class="stats-top"><div id="h-lvl">LVL 1</div><div id="h-time">00:00</div><div id="h-gold">0</div></div>
        <div class="bar-container exp-bar"><div id="exp-fill" class="bar-fill"></div></div>
        <div class="bar-container hp-bar"><div id="hp-fill" class="bar-fill"></div></div>
    </div>
    <div id="auth" class="ui-screen">
        <div class="panel">
            <h1 style="color:var(--primary)">MEGA SURVIVOR</h1>
            <input type="text" id="auth-nick" placeholder="–ù–ò–ö–ù–ï–ô–ú" maxlength="10">
            <button class="btn" onclick="account.login()">–ò–ì–†–ê–¢–¨</button>
            <button id="btn-audio" class="btn btn-sec" onclick="audio.toggle()">SOUND: ON</button>
        </div>
    </div>
    <div id="lobby" class="ui-screen hidden">
        <div class="panel">
            <div id="user-info">–ì–ï–†–û–ô</div>
            <h2 id="user-gold" style="color:var(--gold)">üí∞ 0</h2>
            <button class="btn" onclick="game.preStart()">–í –ë–û–ô</button>
            <button class="btn btn-sec" onclick="ui.showTab('rankings')">–†–ï–ô–¢–ò–ù–ì</button>
        </div>
    </div>
    <div id="rankings" class="ui-screen hidden">
        <div class="panel">
            <h2>–¢–û–ü –ò–ì–†–û–ö–û–í</h2>
            <div id="rank-body" style="text-align:left; margin:10px 0; max-height:200px; overflow-y:auto;"></div>
            <button class="btn btn-sec" onclick="ui.showTab('lobby')">–ù–ê–ó–ê–î</button>
        </div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <div id="joy-base" class="hidden"><div id="joy-stick"></div></div>
    <script>
<script>
/* === // --- ACCOUNT SYSTEM ---
const account = {
    current: null,
    login() {
        const nick = document.getElementById('auth-nick').value.trim() || "Player";
        const saved = localStorage.getItem('mega_save_' + nick);
        this.current = saved ? JSON.parse(saved) : { nick, gold: 0, lvl: 1, bestTime: 0 };
        this.save();
        ui.showTab('lobby');
        this.updateUI();
    },
    save() {
        if (!this.current) return;
        localStorage.setItem('mega_save_' + this.current.nick, JSON.stringify(this.current));
    },
    updateUI() {
        document.getElementById('user-info').innerText = `–ò–ì–†–û–ö: ${this.current.nick}`;
        document.getElementById('user-gold').innerText = `üí∞ ${this.current.gold}`;
    }
};

// --- AUDIO ENGINE (No 404s) ---
const audio = {
    ctx: null,
    enabled: localStorage.getItem('mega_audio_on') !== 'false',
    init() {
        if (this.ctx) return;
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
    },
    toggle() {
        this.enabled = !this.enabled;
        localStorage.setItem('mega_audio_on', this.enabled);
        this.updateBtn();
        if (this.enabled && this.ctx?.state === 'suspended') this.ctx.resume();
    },
    updateBtn() {
        const btn = document.getElementById('btn-audio');
        if (btn) btn.innerText = this.enabled ? "SOUND: ON" : "SOUND: OFF";
    },
    play(freq, type, duration, vol) {
        if (!this.enabled || !this.ctx) return;
        const osc = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(10, this.ctx.currentTime + duration);
        g.gain.setValueAtTime(vol, this.ctx.currentTime);
        g.gain.linearRampToValueAtTime(0, this.ctx.currentTime + duration);
        osc.connect(g); g.connect(this.ctx.destination);
        osc.start(); osc.stop(this.ctx.currentTime + duration);
    },
    shoot() { this.play(800, 'triangle', 0.1, 0.05); },
    boom() { this.play(100, 'sawtooth', 0.3, 0.1); },
    lvl() { this.play(440, 'sine', 0.5, 0.1); }
};
audio.updateBtn();// --- UI CONTROLLER ---
const ui = {
    showTab(id) {
        document.querySelectorAll('.ui-screen').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if (id === 'rankings') this.renderTop();
    },
    renderTop() {
        const container = document.getElementById('rank-body');
        const keys = Object.keys(localStorage).filter(k => k.startsWith('mega_save_'));
        const players = keys.map(k => JSON.parse(localStorage.getItem(k)))
                            .sort((a, b) => b.gold - a.gold).slice(0, 10);
        
        container.innerHTML = players.map((p, i) => 
            `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #222; padding:5px;">
                <span>${i+1}. ${p.nick}</span>
                <span style="color:var(--gold)">üí∞ ${p.gold}</span>
            </div>`
        ).join('') || "–ù–ï–¢ –î–ê–ù–ù–´–•";
    }
};

// --- VIRTUAL JOYSTICK ---
const joy = {
    active: false,
    x: 0, y: 0,
    base: document.getElementById('joy-base'),
    stick: document.getElementById('joy-stick'),
    init() {
        const start = (e) => {
            if (!game.active) return;
            this.active = true;
            this.base.classList.remove('hidden');
            this.move(e);
        };
        const move = (e) => { if (this.active) this.move(e); };
        const end = () => {
            this.active = false;
            this.x = 0; this.y = 0;
            this.base.classList.add('hidden');
        };
        window.addEventListener('touchstart', start);
        window.addEventListener('touchmove', move);
        window.addEventListener('touchend', end);
    },
    move(e) {
        const touch = e.touches[0];
        const bx = this.base.offsetLeft + 50;
        const by = this.base.offsetTop + 50;
        const dx = touch.clientX - bx;
        const dy = touch.clientY - by;
        const dist = Math.sqrt(dx*dx + dy*dy);
        const max = 40;
        const angle = Math.atan2(dy, dx);
        
        const moveX = Math.min(dist, max) * Math.cos(angle);
        const moveY = Math.min(dist, max) * Math.sin(angle);
        
        this.stick.style.transform = `translate(${moveX}px, ${moveY}px)`;
        this.x = moveX / max;
        this.y = moveY / max;
    }
};
joy.init();// --- GAME ENGINE CORE ---
const game = {
    active: false, paused: false,
    width: 0, height: 0, time: 0,
    player: null, enemies: [], bullets: [], xp: [],
    
    preStart() {
        audio.init();
        this.active = true;
        ui.showTab('hud');
        document.getElementById('hud').classList.remove('hidden');
        this.init();
    },

    init() {
        const cvs = document.getElementById('gameCanvas');
        this.width = cvs.width = window.innerWidth;
        this.height = cvs.height = window.innerHeight;
        this.player = {
            x: this.width/2, y: this.height/2,
            hp: 100, maxHp: 100, lvl: 1, exp: 0, nextExp: 50,
            r: 15, speed: 3, lastShot: 0, weaponLvl: 1
        };
        this.enemies = []; this.bullets = []; this.xp = [];
        this.loop();
    },

    spawnEnemy() {
        if (this.enemies.length > 20) return;
        const side = Math.floor(Math.random() * 4);
        let x, y;
        if (side === 0) { x = Math.random()*this.width; y = -30; }
        else if (side === 1) { x = this.width+30; y = Math.random()*this.height; }
        else if (side === 2) { x = Math.random()*this.width; y = this.height+30; }
        else { x = -30; y = Math.random()*this.height; }
        this.enemies.push({ x, y, hp: 2, r: 12, speed: 1 + (this.time/3600) });
    },

    update() {
        if (!this.active || this.paused) return;
        this.time++;

        // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ –¥–∂–æ–π—Å—Ç–∏–∫
        this.player.x += joy.x * this.player.speed;
        this.player.y += joy.y * this.player.speed;

        // –ê–≤—Ç–æ—Å—Ç—Ä–µ–ª—å–±–∞ –ø–æ –±–ª–∏–∂–∞–π—à–µ–º—É –≤—Ä–∞–≥—É
        if (this.time - this.player.lastShot > 30) {
            let target = null, minDist = 300;
            this.enemies.forEach(e => {
                const d = Math.hypot(e.x - this.player.x, e.y - this.player.y);
                if (d < minDist) { minDist = d; target = e; }
            });
            if (target) {
                const angle = Math.atan2(target.y - this.player.y, target.x - this.player.x);
                this.bullets.push({ x: this.player.x, y: this.player.y, angle, speed: 7 });
                audio.shoot();
                this.player.lastShot = this.time;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å
        this.bullets.forEach((b, i) => {
            b.x += Math.cos(b.angle) * b.speed;
            b.y += Math.sin(b.angle) * b.speed;
            if (b.x < 0 || b.x > this.width || b.y < 0 || b.y > this.height) this.bullets.splice(i, 1);
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
        if (this.time % 60 === 0) this.spawnEnemy();
        this.enemies.forEach((e, i) => {
            const angle = Math.atan2(this.player.y - e.y, this.player.x - e.x);
            e.x += Math.cos(angle) * e.speed;
            e.y += Math.sin(angle) * e.speed;

            // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ –ø—É–ª—è-–≤—Ä–∞–≥
            this.bullets.forEach((b, bi) => {
                if (Math.hypot(e.x - b.x, e.y - b.y) < e.r) {
                    e.hp--;
                    this.bullets.splice(bi, 1);
                    if (e.hp <= 0) {
                        this.xp.push({ x: e.x, y: e.y, val: 10 });
                        this.enemies.splice(i, 1);
                        audio.boom();
                    }
                }
            });

            // –£—Ä–æ–Ω –∏–≥—Ä–æ–∫—É
            if (Math.hypot(e.x - this.player.x, e.y - this.player.y) < e.r + this.player.r) {
                this.player.hp -= 0.5;
                if (this.player.hp <= 0) this.gameOver();
            }
        });

        // –°–±–æ—Ä –æ–ø—ã—Ç–∞
        this.xp.forEach((x, xi) => {
            if (Math.hypot(x.x - this.player.x, x.y - this.player.y) < 40) {
                this.player.exp += x.val;
                this.xp.splice(xi, 1);
                if (this.player.exp >= this.player.nextExp) this.levelUp();
            }
        });

        this.updateHUD();
    },

    levelUp() {
        this.player.lvl++;
        this.player.exp = 0;
        this.player.nextExp *= 1.5;
        this.player.maxHp += 10;
        this.player.hp = this.player.maxHp;
        audio.lvl();
    },

    updateHUD() {
        document.getElementById('h-lvl').innerText = `LVL ${this.player.lvl}`;
        document.getElementById('h-gold').innerText = account.current.gold;
        document.getElementById('hp-fill').style.width = (this.player.hp / this.player.maxHp * 100) + '%';
        document.getElementById('exp-fill').style.width = (this.player.exp / this.player.nextExp * 100) + '%';
        const sec = Math.floor(this.time / 60);
        document.getElementById('h-time').innerText = `${Math.floor(sec/60)}:${(sec%60).toString().padStart(2,'0')}`;
    }
};// --- RENDERING ENGINE ---
game.loop = function() {
    if (!game.active) return;
    const cvs = document.getElementById('gameCanvas');
    const ctx = cvs.getContext('2d');
    
    // –û—á–∏—Å—Ç–∫–∞ —ç–∫—Ä–∞–Ω–∞
    ctx.fillStyle = '#050805';
    ctx.fillRect(0, 0, game.width, game.height);

    game.update();

    // –†–∏—Å—É–µ–º –æ–ø—ã—Ç (–∫—Ä–∏—Å—Ç–∞–ª–ª—ã)
    ctx.fillStyle = '#00d4ff';
    game.xp.forEach(x => {
        ctx.beginPath();
        ctx.arc(x.x, x.y, 4, 0, Math.PI * 2);
        ctx.fill();
    });

    // –†–∏—Å—É–µ–º –ø—É–ª–∏
    ctx.fillStyle = '#fff';
    game.bullets.forEach(b => {
        ctx.fillRect(b.x - 2, b.y - 2, 4, 4);
    });

    // –†–∏—Å—É–µ–º –≤—Ä–∞–≥–æ–≤
    ctx.fillStyle = '#ff0055';
    game.enemies.forEach(e => {
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
        ctx.fill();
        // –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –≤—Ä–∞–≥–∞
        ctx.fillStyle = '#333';
        ctx.fillRect(e.x - 10, e.y - 20, 20, 3);
        ctx.fillStyle = '#ff0055';
        ctx.fillRect(e.x - 10, e.y - 20, (e.hp / 2) * 20, 3);
    });

    // –†–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞
    ctx.fillStyle = '#00d4ff';
    ctx.shadowBlur = 15;
    ctx.shadowColor = '#00d4ff';
    ctx.beginPath();
    ctx.arc(game.player.x, game.player.y, game.player.r, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;

    requestAnimationFrame(() => game.loop());
};

game.gameOver = function() {
    this.active = false;
    const earned = Math.floor(this.time / 10);
    account.current.gold += earned;
    account.save();
    alert(`–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê! –í–´ –ó–ê–†–ê–ë–û–¢–ê–õ–ò: üí∞${earned}`);
    location.reload(); 
};

// --- INITIALIZATION ---
window.addEventListener('load', () => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –Ω–∏–∫–∞
    const lastKeys = Object.keys(localStorage).filter(k => k.startsWith('mega_save_'));
    if (lastKeys.length > 0) {
        document.getElementById('auth-nick').value = lastKeys[0].replace('mega_save_', '');
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    window.addEventListener('resize', () => {
        if (game.active) {
            game.width = gameCanvas.width = window.innerWidth;
            game.height = gameCanvas.height = window.innerHeight;
        }
    });
});

// –ê–ö–¢–ò–í–ê–¢–û–† –ê–î–ú–ò–ù–ö–ò (–°–ï–ö–†–ï–¢–ù–´–ô –ö–õ–Æ–ß)
if (window.location.search.includes('ad123')) {
    const checkAdmin = setInterval(() => {
        const subBtns = document.querySelector('.sub-btns');
        if (subBtns) {
            const btn = document.createElement('button');
            btn.className = 'btn btn-sec';
            btn.innerText = 'ADMIN';
            btn.onclick = () => {
                const n = prompt("–°–ö–û–õ–¨–ö–û –ó–û–õ–û–¢–ê?");
                if(n) { account.current.gold += parseInt(n); account.save(); account.updateUI(); }
            };
            subBtns.appendChild(btn);
            clearInterval(checkAdmin);
        }
    }, 500);
}

</script>
</body>
</html> === */
    </script>
</body>
</html>
