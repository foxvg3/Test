<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MEGA SURVIVOR IO</title>
    <style>
        :root { 
            --p: #00ff88; --bg: #222; --panel: #fff; --text: #333;
            --gold: #ffaa00; --red: #ff4444; --rare: #a335ee;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; font-family: 'Segoe UI', sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; width: 100vw; }
        
        #game-bg {
            position: absolute; inset: 0; z-index: 0;
            background-color: #80c080;
            background-image: 
                linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 60px 60px;
        }
        canvas { position: absolute; inset: 0; z-index: 1; pointer-events: none; }

        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; z-index: 10; background: #f0f0f0; transition: 0.2s; }
        .hidden { display: none !important; }
        
        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 15px; background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 20;
        }
        .player-lvl { display: flex; align-items: center; gap: 10px; font-weight: bold; font-size: 14px; cursor: pointer; }
        .lvl-badge {
            background: var(--p); color: #000; width: 30px; height: 30px; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #000;
        }
        .res-box { background: #333; color: var(--gold); padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; }

        .tab-content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .nav-bar {
            position: absolute; bottom: 0; left: 0; right: 0; height: 70px;
            background: #fff; display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid #ddd; z-index: 30;
        }
        .nav-btn { flex: 1; text-align: center; font-size: 10px; color: #999; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-btn.active { color: var(--p); font-weight: bold; }
        .nav-icon { font-size: 24px; }

        .card { background: #fff; border-radius: 12px; padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .btn { background: var(--p); color: #000; border: none; padding: 12px; border-radius: 8px; font-weight: 800; width: 100%; cursor: pointer; box-shadow: 0 4px 0 #00cc6a; }
        .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #00cc6a; }
        .btn-blue { background: #4488ff; box-shadow: 0 4px 0 #2266dd; color: white; }
        
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .hero-slot { background: #eee; border-radius: 10px; padding: 10px; text-align: center; border: 2px solid transparent; cursor: pointer; }
        .hero-slot.selected { border-color: var(--p); background: #eeffee; }
        .frag-prog { font-size: 9px; background: #000; color: #fff; padding: 2px 6px; border-radius: 10px; margin-top: 4px; }

        #admin-modal { background: rgba(0,0,0,0.95); color: #fff; padding: 20px; z-index: 200; }
        #hud { pointer-events: none; position: absolute; inset: 0; padding: 10px; z-index: 50; color: #fff; text-shadow: 1px 1px 0 #000; }
        .bar-wrap { width: 100%; height: 12px; background: rgba(0,0,0,0.5); border-radius: 6px; overflow: hidden; margin-bottom: 4px; border: 1px solid #fff; }
        #joy-zone { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); width: 150px; height: 150px; z-index: 40; border-radius: 50%; background: rgba(255,255,255,0.1); }
        
        table { width: 100%; border-collapse: collapse; }
        th { background: #eee; padding: 10px; font-size: 12px; }
        td { padding: 10px; border-bottom: 1px solid #eee; font-size: 12px; }
    </style>
</head>
<body>

<div id="ui-layer" class="screen">
    <div class="top-bar">
        <div class="player-lvl" onclick="ui.showLvlDetails()">
            <div class="lvl-badge" id="g-lvl">1</div>
            <div>
                <div style="font-size:10px; color:#777">LEVEL (INFO)</div>
                <div style="width:80px; height:6px; background:#ddd; border-radius:3px; overflow:hidden;">
                    <div id="g-xp-bar" style="width:0%; height:100%; background:#4488ff;"></div>
                </div>
            </div>
        </div>
        <div class="res-box">üí∞ <span id="g-gold">0</span></div>
    </div>

    <div id="tab-shop" class="tab-content hidden">
        <h2 style="text-align:center;">–ú–ê–ì–ê–ó–ò–ù</h2>
        <div class="card">üì¶ –î–ï–†–ï–í–Ø–ù–ù–´–ô <button class="btn btn-blue" onclick="meta.openChest(0)">1000 üí∞</button></div>
        <div class="card">üó≥Ô∏è –°–ï–†–ï–ë–†–Ø–ù–´–ô <button class="btn btn-blue" onclick="meta.openChest(1)">3000 üí∞</button></div>
        <div class="card">üëë –ó–û–õ–û–¢–û–ô <button class="btn btn-blue" onclick="meta.openChest(2)">5000 üí∞</button></div>
    </div>

    <div id="tab-heroes" class="tab-content">
        <div class="card">
            <h3>–†–ï–ñ–ò–ú</h3>
            <select id="game-mode" class="btn" style="background:#fff; color:#000; border:1px solid #ccc; margin-bottom:10px;">
                <option value="normal">üü¢ –û–ë–´–ß–ù–´–ô</option>
                <option value="endless">üîí –ë–ï–°–ö–û–ù–ï–ß–ù–´–ô (LVL 3)</option>
                <option value="boss">üîí –û–•–û–¢–ê –ù–ê –ë–û–°–°–û–í (LVL 6)</option>
            </select>
            <button class="btn" onclick="game.preStart()">–ò–ì–†–ê–¢–¨</button>
        </div>
        <div id="hero-grid" class="grid-3"></div>
        <div id="hero-upg-panel" class="card hidden">
            <b id="upg-name"></b> <span id="upg-lvl"></span>
            <div id="upg-bar-box" style="height:6px; background:#ddd; margin:10px 0;"><div id="upg-bar" style="height:100%; background:var(--p); width:0%"></div></div>
            <button id="btn-upg-hero" class="btn" onclick="meta.upgradeHero()">–£–õ–£–ß–®–ò–¢–¨</button>
        </div>
    </div>

    <div id="tab-tree" class="tab-content hidden">
        <h3>–î–†–ï–í–û –ù–ê–í–´–ö–û–í (–û—á–∫–∏: <span id="tree-points">0</span>)</h3>
        <div id="tree-list"></div>
    </div>

    <div id="tab-rank" class="tab-content hidden">
        <div style="display:flex; gap:5px; margin-bottom:10px;">
            <button class="btn btn-blue" style="font-size:10px" onclick="ui.showTop('lvl')">–¢–û–ü LVL</button>
            <button class="btn btn-blue" style="font-size:10px" onclick="ui.showTop('endless')">–ë–ï–°–ö–û–ù–ï–ß–ù–´–ô</button>
            <button class="btn btn-blue" style="font-size:10px" onclick="ui.showTop('boss')">–ë–û–°–°–´</button>
        </div>
        <div class="card" style="padding:0">
            <table>
                <thead><tr><th>#</th><th>–ò–ì–†–û–ö</th><th id="rank-col">LVL</th></tr></thead>
                <tbody id="rank-body"></tbody>
            </table>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-btn" onclick="ui.tab('shop')">üõí<span>–ú–∞–≥–∞–∑–∏–Ω</span></div>
        <div class="nav-btn active" onclick="ui.tab('heroes')">üéÆ<span>–ò–≥—Ä–∞</span></div>
        <div class="nav-btn" onclick="ui.tab('tree')">üß¨<span>–ù–∞–≤—ã–∫–∏</span></div>
        <div class="nav-btn" onclick="ui.tab('rank')">üèÜ<span>–¢–æ–ø</span></div>
    </div>
</div>

<div id="game-layer" class="screen hidden" style="background:transparent;">
    <div id="game-bg"></div>
    <canvas id="cvs"></canvas>
    <div id="hud">
        <div class="bar-wrap"><div id="hp-bar" style="width:100%; background:var(--red);"></div></div>
        <div class="bar-wrap"><div id="xp-bar" style="width:0%; background:var(--p);"></div></div>
        <div style="display:flex; justify-content:space-between;">
            <span id="h-lvl">LVL 1</span><span id="h-time">00:00</span><span id="h-kill">0 üíÄ</span>
        </div>
    </div>
    <div id="joy-zone"></div>
</div>

<div id="lvl-details" class="screen hidden" style="background:rgba(0,0,0,0.9); color:#fff; padding:20px; justify-content:center;">
    <div class="card" style="color:#000">
        <h2>–ü–†–û–§–ò–õ–¨</h2>
        <p>–£—Ä–æ–≤–µ–Ω—å: <b id="det-lvl"></b></p>
        <p>–û–ø—ã—Ç: <span id="det-xp"></span></p>
        <p>–†–µ–∫–æ—Ä–¥ –≤—Ä–µ–º–µ–Ω–∏: <span id="det-time"></span></p>
        <button class="btn" onclick="document.getElementById('lvl-details').classList.add('hidden')">–ó–ê–ö–†–´–¢–¨</button>
    </div>
</div>

<div id="popup-overlay" class="screen hidden" style="background:rgba(0,0,0,0.8); z-index:100; justify-content:center; align-items:center;">
    <div id="popup-content" style="width:80%; background:#fff; padding:20px; border-radius:15px; color:#000;"></div>
</div>

<div id="admin-modal" class="screen hidden">
    <h2>ADMIN PANEL (/?ad123)</h2>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        <button class="btn btn-blue" onclick="cheat.toggleVoid()">–ß–ï–†–ù–ê–Ø –î–´–†–ê</button>
        <button class="btn btn-blue" onclick="cheat.toggleGod()">–ë–ï–°–°–ú–ï–†–¢–ò–ï</button>
        <button class="btn" onclick="cheat.killAll()">–£–ë–ò–¢–¨ –í–°–ï–•</button>
        <button class="btn" onclick="cheat.magnet()">–ú–ê–ì–ù–ò–¢</button>
        <button class="btn" onclick="cheat.spawnBoss()">–ë–û–°–° (+5 –ú–ò–ù)</button>
        <button class="btn" onclick="cheat.queueLvl()">–£–†–û–í–ï–ù–¨ +1</button>
        <button class="btn btn-blue" onclick="cheat.addGold()">+10k GOLD</button>
        <button class="btn btn-red" onclick="cheat.reset()">–°–ë–†–û–° –í–°–ï–ì–û</button>
    </div>
    <button class="btn" style="margin-top:20px;" onclick="cheat.close()">–í–´–ô–¢–ò</button>
</div>

<script>
const DB_KEY = 'surv_v6_final';
const IS_ADMIN = location.search.includes('?ad123');

const CHARS = {
    square: { name: '–ö–≤–∞–¥—Ä–∞—Ç', desc: '–°—Ç—Ä–µ–ª—è–µ—Ç –≤–ø–µ—Ä–µ–¥', skill: 'shot' },
    circle: { name: '–ö—Ä—É–≥', desc: '–ê—É—Ä–∞ –æ–≥–Ω—è', skill: 'aura_fire' },
    hex: { name: '–ì–µ–∫—Å', desc: '–©–∏—Ç—ã', skill: 'orbit_shield' },
    bolt: { name: '–ë–æ–ª—Ç', desc: '–ú–æ–ª–Ω–∏–∏', skill: 'lightning' },
    robot: { name: '–†–æ–±–æ—Ç', desc: '–õ–∞–∑–µ—Ä', skill: 'laser' },
    alien: { name: '–ß—É–∂–æ–π', desc: '–ü–ª–∞–∑–º–∞', skill: 'plasma' },
    skull: { name: '–ß–µ—Ä–µ–ø', desc: '–Ø–¥', skill: 'aura_toxic' },
    ghost: { name: '–ü—Ä–∏–∑—Ä–∞–∫', desc: '–§–∞–∑–∏—Ä–æ–≤–∞–Ω–∏–µ', skill: 'phase' },
    heart: { name: '–°–µ—Ä–¥—Ü–µ', desc: '–í–∞–º–ø–∏—Ä–∏–∑–º', skill: 'vampire' },
    star: { name: '–ó–≤–µ–∑–¥–∞', desc: '–ú–∞–≥–∏—è', skill: 'magic_missile' },
    cross: { name: '–ö—Ä–µ—Å—Ç', desc: '–†–µ–≥–µ–Ω', skill: 'regen_aura' },
    penta: { name: '–ü–µ–Ω—Ç–∞', desc: '–ü—Ä–∏–∑—ã–≤', skill: 'summon' },
    moon: { name: '–õ—É–Ω–∞', desc: '–•–æ–ª–æ–¥', skill: 'aura_ice' },
    spade: { name: '–ü–∏–∫–∞', desc: '–ö—Ä–∏—Ç—ã', skill: 'crit_buff' }
};

const SKILLS = [
    {id:'shot', name:'–ü—É–ª—è', type:'act'}, {id:'aura_fire', name:'–û–≥–æ–Ω—å', type:'act'},
    {id:'orbit_shield', name:'–©–∏—Ç', type:'act'}, {id:'lightning', name:'–ú–æ–ª–Ω–∏—è', type:'act'},
    {id:'aura_toxic', name:'–Ø–¥', type:'act'}, {id:'laser', name:'–õ–∞–∑–µ—Ä', type:'act'},
    {id:'might', name:'–£—Ä–æ–Ω', type:'pas'}, {id:'magnet', name:'–ú–∞–≥–Ω–∏—Ç', type:'pas'},
    {id:'armor', name:'–ë—Ä–æ–Ω—è', type:'pas'}, {id:'growth', name:'–û–ø—ã—Ç+', type:'pas'}
];

const app = {
    data: { gold: 500, playerLvl: 1, playerXp: 0, unlocked: ['square'], fragments: {}, heroLevels: {}, tech: {hp:0, dmg:0, def:0}, stats: {mode_normal:0, mode_endless:0, mode_boss:0} },
    init() {
        const load = localStorage.getItem(DB_KEY);
        if(load) this.data = JSON.parse(load);
        Object.keys(CHARS).forEach(k => {
            if(!this.data.fragments[k]) this.data.fragments[k] = 0;
            if(!this.data.heroLevels[k]) this.data.heroLevels[k] = 1;
        });
        ui.updateLobby();
        if(IS_ADMIN) { const b = document.createElement('button'); b.innerText="ADMIN"; b.className="btn"; b.onclick=cheat.open; document.querySelector('.top-bar').appendChild(b); }
    },
    save() { localStorage.setItem(DB_KEY, JSON.stringify(this.data)); ui.updateLobby(); },
    addXp(v) { this.data.playerXp += v; const req = this.data.playerLvl * 100; if(this.data.playerXp >= req) { this.data.playerXp -= req; this.data.playerLvl++; } this.save(); }
};

const ui = {
    selHero: 'square',
    tab(id) {
        document.querySelectorAll('.tab-content').forEach(e => e.classList.add('hidden'));
        document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
        document.getElementById('tab-'+id).classList.remove('hidden');
        if(id==='rank') this.showTop('lvl');
        if(id==='tree') this.renderTree();
    },
    updateLobby() {
        document.getElementById('g-lvl').innerText = app.data.playerLvl;
        document.getElementById('g-gold').innerText = app.data.gold;
        document.getElementById('g-xp-bar').style.width = (app.data.playerXp / (app.data.playerLvl*100)*100)+'%';
        const grid = document.getElementById('hero-grid'); grid.innerHTML = '';
        Object.keys(CHARS).forEach(k => {
            const el = document.createElement('div'); el.className = `hero-slot ${this.selHero===k?'selected':''}`;
            el.innerHTML = `<div>üë§</div><div style="font-size:10px">${CHARS[k].name}</div><div class="frag-prog">${app.data.heroLevels[k]}‚≠ê</div>`;
            el.onclick = () => { this.selHero = k; this.updateLobby(); };
            grid.appendChild(el);
        });
        const h = CHARS[this.selHero];
        document.getElementById('upg-name').innerText = h.name;
        document.getElementById('upg-lvl').innerText = app.data.heroLevels[this.selHero] + ' LVL';
        document.getElementById('upg-bar').style.width = (app.data.fragments[this.selHero] / (app.data.heroLevels[this.selHero]*10)*100)+'%';
        document.getElementById('hero-upg-panel').classList.remove('hidden');
    },
    showLvlDetails() {
        const d = document.getElementById('lvl-details'); d.classList.remove('hidden');
        document.getElementById('det-lvl').innerText = app.data.playerLvl;
        document.getElementById('det-xp').innerText = app.data.playerXp + ' / ' + (app.data.playerLvl*100);
        document.getElementById('det-time').innerText = Math.floor(app.data.stats.mode_endless/1000) + ' —Å–µ–∫';
    },
    showTop(type) {
        const b = document.getElementById('rank-body'); b.innerHTML = '';
        document.getElementById('rank-col').innerText = type==='lvl'?'LVL':'TIME';
        for(let i=1; i<=100; i++) {
            b.innerHTML += `<tr><td>${i}</td><td>Player_${Math.floor(Math.random()*999)}</td><td>${101-i}</td></tr>`;
        }
    },
    renderTree() {
        const list = document.getElementById('tree-list'); list.innerHTML = '';
        const pts = (app.data.playerLvl-1) - (app.data.tech.hp + app.data.tech.dmg + app.data.tech.def);
        document.getElementById('tree-points').innerText = pts;
        ['hp','dmg','def'].forEach(id => {
            list.innerHTML += `<div class="card">${id.toUpperCase()} (Lvl ${app.data.tech[id]}) <button class="btn btn-blue" onclick="meta.buyTech('${id}')">UP (500üí∞)</button></div>`;
        });
    }
};

const meta = {
    openChest(t) {
        const costs = [1000, 3000, 5000];
        if(app.data.gold < costs[t]) return alert("–ú–∞–ª–æ –¥–µ–Ω–µ–≥");
        app.data.gold -= costs[t];
        const res = Object.keys(CHARS)[Math.floor(Math.random()*Object.keys(CHARS).length)];
        app.data.fragments[res] += (t+1)*5;
        app.save(); alert("–í—ã–ø–∞–ª–æ: " + CHARS[res].name);
    },
    upgradeHero() {
        const id = ui.selHero; const req = app.data.heroLevels[id]*10;
        if(app.data.fragments[id]>=req) { app.data.fragments[id]-=req; app.data.heroLevels[id]++; app.save(); }
    },
    buyTech(id) {
        const pts = (app.data.playerLvl-1) - (app.data.tech.hp + app.data.tech.dmg + app.data.tech.def);
        if(pts>0 && app.data.gold>=500) { app.data.gold-=500; app.data.tech[id]++; app.save(); ui.renderTree(); }
    }
};

const game = {
    active: false, paused: false, enemies: [], bullets: [], items: [], props: [], time: 0, cheats: {void:false, god:false},
    preStart() {
        document.getElementById('ui-layer').classList.add('hidden');
        document.getElementById('game-layer').classList.remove('hidden');
        this.start();
    },
    start() {
        const cvs = document.getElementById('cvs'); this.ctx = cvs.getContext('2d');
        this.w = cvs.width = window.innerWidth; this.h = cvs.height = window.innerHeight;
        this.player = { x: this.w/2, y: this.h/2, hp: 100, maxHp: 100, lvl:1, xp:0, nextXp:10, skills: {[CHARS[ui.selHero].skill]: 1} };
        this.enemies = []; this.bullets = []; this.items = []; this.props = []; this.time = 0; this.active = true;
        this.joy = {on:false, dx:0, dy:0}; this.initInput();
        requestAnimationFrame(() => this.loop());
    },
    loop() {
        if(!this.active || this.paused) return;
        this.time += 16; this.update(); this.render();
        requestAnimationFrame(() => this.loop());
    },
    update() {
        const p = this.player;
        if(this.joy.on) { p.x += this.joy.dx*3; p.y += this.joy.dy*3; }
        if(this.time % 1000 < 16) {
            const a = Math.random()*6.28;
            this.enemies.push({x:p.x+Math.cos(a)*300, y:p.y+Math.sin(a)*300, hp:20, maxHp:20, color:'#f44'});
        }
        if(this.time % 5000 < 16) this.props.push({x:p.x+Math.random()*400-200, y:p.y+Math.random()*400-200});
        
        this.enemies.forEach((e,i) => {
            if(this.cheats.void) { e.x -= 5; } else {
                const ang = Math.atan2(p.y-e.y, p.x-e.x); e.x+=Math.cos(ang); e.y+=Math.sin(ang);
            }
            if(Math.hypot(p.x-e.x, p.y-e.y)<20 && !this.cheats.god) { p.hp -= 0.2; if(p.hp<=0) this.over(); }
            if(e.hp<=0) { this.enemies.splice(i,1); this.items.push({x:e.x, y:e.y, type:'xp'}); app.addXp(1); }
        });
        
        this.bullets.forEach((b,i) => {
            b.x+=b.vx; b.y+=b.vy;
            this.enemies.forEach(e => { if(Math.hypot(b.x-e.x, b.y-e.y)<20) { e.hp-=10; b.life=0; } });
            if(b.life-- < 0) this.bullets.splice(i,1);
        });

        if(this.time % 1000 < 16) {
            const e = this.enemies[0];
            if(e) {
                const ang = Math.atan2(e.y-p.y, e.x-p.x);
                this.bullets.push({x:p.x, y:p.y, vx:Math.cos(ang)*7, vy:Math.sin(ang)*7, life:100, color:'#ff0'});
            }
        }

        this.items.forEach((it,i) => {
            if(Math.hypot(p.x-it.x, p.y-it.y)<30) { p.xp+=2; this.items.splice(i,1); }
            if(p.xp>=p.nextXp) { p.xp=0; p.lvl++; p.nextXp*=1.5; this.paused=true; this.lvlUp(); }
        });
    },
    render() {
        const c = this.ctx; c.clearRect(0,0,this.w,this.h);
        const ox = this.w/2-this.player.x; const oy = this.h/2-this.player.y;
        document.getElementById('game-bg').style.backgroundPosition = `${ox}px ${oy}px`;
        c.save(); c.translate(ox, oy);
        this.enemies.forEach(e => { c.fillStyle=e.color; c.beginPath(); c.arc(e.x,e.y,15,0,7); c.fill(); });
        this.bullets.forEach(b => { c.fillStyle=b.color; c.beginPath(); c.arc(b.x,b.y,5,0,7); c.fill(); });
        this.items.forEach(it => { c.fillStyle='#0f8'; c.beginPath(); c.arc(it.x,it.y,4,0,7); c.fill(); });
        this.props.forEach(pr => { c.fillStyle='#842'; c.fillRect(pr.x-10,pr.y-10,20,20); });
        c.fillStyle='#fff'; c.fillRect(this.player.x-10,this.player.y-10,20,20);
        c.restore();
        document.getElementById('hp-bar').style.width = (this.player.hp)+'%';
        document.getElementById('xp-bar').style.width = (this.player.xp/this.player.nextXp*100)+'%';
        document.getElementById('h-time').innerText = Math.floor(this.time/1000)+'s';
    },
    lvlUp() {
        document.getElementById('popup-content').innerHTML = `<h3>LEVEL UP</h3><button class="btn" onclick="game.paused=false; game.loop(); document.getElementById('popup-overlay').classList.add('hidden')">CONTINUE</button>`;
        document.getElementById('popup-overlay').classList.remove('hidden');
    },
    over() { alert("Game Over"); location.reload(); },
    initInput() {
        const z = document.getElementById('joy-zone');
        const f = (e) => {
            const t = e.touches?e.touches[0]:e; const r = z.getBoundingClientRect();
            const dx = t.clientX-(r.left+r.width/2); const dy = t.clientY-(r.top+r.height/2);
            const a = Math.atan2(dy,dx); this.joy = {on:true, dx:Math.cos(a), dy:Math.sin(a)};
        };
        z.onmousedown = f; z.ontouchstart = f; window.onmouseup = window.ontouchend = () => this.joy.on=false;
    }
};

const cheat = {
    open() { document.getElementById('admin-modal').classList.remove('hidden'); },
    close() { document.getElementById('admin-modal').classList.add('hidden'); },
    toggleVoid() { game.cheats.void = !game.cheats.void; },
    toggleGod() { game.cheats.god = !game.cheats.god; },
    killAll() { game.enemies = []; },
    magnet() { game.items.forEach(i => {i.x=game.player.x; i.y=game.player.y;}); },
    spawnBoss() { game.time += 300000; },
    queueLvl() { app.data.playerXp = app.data.playerLvl*100; app.addXp(0); },
    addGold() { app.data.gold += 10000; app.save(); },
    reset() { localStorage.removeItem(DB_KEY); location.reload(); }
};

window.onload = () => app.init();
</script>
</body>
</html>
